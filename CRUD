// Ø¥Ø¶Ø§ÙØ© Ø³Ø¬Ù„ Ø¬Ø¯ÙŠØ¯
async function addRecord() {
  const { data, error } = await supabase
    .from('employees')
    .insert({
      civil_id: document.getElementById('civilId').value,
      full_name: document.getElementById('name').value,
      specialty: document.getElementById('specialty').value,
      current_job: document.getElementById('currentJob').value,
      entry_date: document.getElementById('date').value,
      delay_minutes: document.getElementById('delay').value
    })
    .select()

  if (error) alert('Ø­Ø¯Ø« Ø®Ø·Ø£: ' + error.message)
  else updateTable()
}

// Ø¹Ø±Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
async function showData() {
  const { data, error } = await supabase
    .from('employees')
    .select('*')
    .order('created_at', { ascending: false })

  if (!error) {
    const tbody = document.querySelector('#dataTable tbody')
    tbody.innerHTML = data.map(emp => `
      <tr data-id="${emp.id}">
        <td>${emp.civil_id}</td>
        <td>${emp.full_name}</td>
        <td>${emp.specialty}</td>
        <td>${emp.delay_minutes}</td>
        <td>
          <button onclick="editRecord('${emp.id}')">âœï¸</button>
          <button onclick="deleteRecord('${emp.id}')">ğŸ—‘ï¸</button>
        </td>
      </tr>
    `).join('')
  }
}

// Ø§Ù„ØªØ¹Ø¯ÙŠÙ„
async function editRecord(id) {
  const { data, error } = await supabase
    .from('employees')
    .update({
      delay_minutes: prompt('Ø£Ø¯Ù‚ Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© Ù„Ù„ØªØ£Ø®ÙŠØ±:')
    })
    .eq('id', id)

  if (!error) showData()
}

// Ø§Ù„Ø­Ø°Ù
async function deleteRecord(id) {
  if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø­Ø°ÙØŸ')) {
    const { error } = await supabase
      .from('employees')
      .delete()
      .eq('id', id)

    if (!error) showData()
  }
}
document.addEventListener('DOMContentLoaded', showData)

function handleError(error) {
  console.error('Error:', error)
  alert(`Ø­Ø¯Ø« Ø®Ø·Ø£: ${error.message}`)
}

// Ø§Ø³ØªØ®Ø¯Ø§Ù…Ù‡Ø§ ÙÙŠ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¯ÙˆØ§Ù„:
async function showData() {
  try {
    // ...Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø³Ø§Ø¨Ù‚...
  } catch (error) {
    handleError(error)
  }
}// ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
async function login(email, password) {
  const { data, error } = await supabase.auth.signInWithPassword({
    email,
    password
  })

  if (error) throw error
  return data.user
}// ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ
const channel = supabase
  .channel('employees')
  .on('postgres_changes', { event: '*', schema: 'public' }, () => showData())
  .subscribe()
